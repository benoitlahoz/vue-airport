# Debounce Plugin Example - Search with Debouncing

Demonstration of the debouncing plugin to optimize high-frequency events.

## Interactive Demo

::debounce-example
::

## Overview

This example highlights:
- **Event debouncing** for check-in/check-out operations
- **Real-time search** with optimized performance
- **Automatic batching** of notifications
- **Manual control** with flush/cancel
- **Tracking pending operations**

## Architecture

### Debounce Plugin

The `createDebouncePlugin` plugin groups event notifications to avoid unnecessary processing during rapid operations.

```typescript
import { createDebouncePlugin } from 'vue-checkin';

const debouncePlugin = createDebouncePlugin({
  checkInDelay: 500,    // Delay for check-in events
  checkOutDelay: 300,   // Delay for check-out events
  maxWait: 2000,        // Maximum delay before forced execution
});
```

### Main Component: `DebounceExample.vue`

The component manages a real-time search with event debouncing.

```vue
<script setup lang="ts">
import { useCheckIn } from 'vue-checkin';
import { createDebouncePlugin, createLoggerPlugin } from 'vue-checkin/plugins';

interface SearchResult {
  title: string;
  description: string;
  category: string;
}

// Create the debounce plugin
const debouncePlugin = createDebouncePlugin<SearchResult>({
  checkInDelay: 500,
  checkOutDelay: 300,
  maxWait: 2000,
});

// Add a logger to see events
const loggerPlugin = createLoggerPlugin<SearchResult>({
  prefix: '[Search]',
  verbose: true,
});

// Create a desk with the plugins
const { createDesk } = useCheckIn<SearchResult>();
const { desk } = createDesk('search-desk', {
  debug: false,
  plugins: [debouncePlugin, loggerPlugin],
});

// Extended type for plugin methods
type DeskWithDebounce = typeof desk & {
  pendingCheckInsCount?: Ref<number>;
  hasPendingDebounce?: Ref<boolean>;
  flushDebounce?: () => void;
  cancelDebounce?: () => void;
  onDebouncedCheckIn?: (callback: (id: string | number, data: SearchResult) => void) => void;
};

const deskWithDebounce = desk as DeskWithDebounce;

// Listen to debounced events
deskWithDebounce.onDebouncedCheckIn?.((id, data) => {
  console.log('Debounced event:', data.title);
});
</script>
```

### Result Component: `SearchResultItem.vue`

Each search result automatically registers with the desk.

```vue
<script setup lang="ts">
import { checkInToDesk } from 'vue-checkin';

interface Props {
  id: string;
  title: string;
  description: string;
  category: string;
}

const props = defineProps<Props>();

// Auto check-in
const { checkOut, updateSelf } = checkInToDesk('search-desk', {
  id: props.id,
  data: {
    title: props.title,
    description: props.description,
    category: props.category,
  },
});

// Sync changes
watch(() => [props.title, props.description, props.category], () => {
  updateSelf({
    title: props.title,
    description: props.description,
    category: props.category,
  });
});

// Automatic cleanup
onUnmounted(() => {
  checkOut();
});
</script>
```

## How Debouncing Works

### What is debouncing?

Debouncing is a technique that delays the execution of a function until a certain time has elapsed since the last call.

```
Without debounce:
Type: "v"     → Event
Type: "vu"    → Event  
Type: "vue"   → Event
Result: 3 events

With debounce (300ms):
Type: "v"     → Wait...
Type: "vu"    → Wait...
Type: "vue"   → Wait... → Event after 300ms
Result: 1 event
```

### Plugin Configuration

```typescript
createDebouncePlugin({
  // Delay before triggering check-in event
  checkInDelay: 500,
  
  // Delay before triggering check-out event
  checkOutDelay: 300,
  
  // Maximum wait time before forced execution
  // Prevents waiting indefinitely if operations are continuous
  maxWait: 2000,
})
```

### Available Methods

The plugin adds several methods to the desk:

```typescript
// Force immediate execution of pending events
desk.flushDebounce();

// Cancel all pending events
desk.cancelDebounce();

// Subscribe to debounced events
desk.onDebouncedCheckIn((id, data) => {
  console.log('Debounced check-in:', id);
});

desk.onDebouncedCheckOut((id) => {
  console.log('Debounced check-out:', id);
});
```

### Computed Properties

The plugin also exposes reactive properties:

```typescript
// Number of pending check-in events
const pending = desk.pendingCheckInsCount;

// Number of pending check-out events
const pendingOut = desk.pendingCheckOutsCount;

// Check if there are pending operations
const hasPending = desk.hasPendingDebounce;
```

## Use Cases

### 1. Real-Time Search

Avoid triggering an API search on every keystroke:

```vue
<script setup>
const searchQuery = ref('');

watch(searchQuery, (query) => {
  // Check-ins will be automatically debounced
  searchResults.value.forEach(result => {
    desk.checkIn(result.id, result);
  });
});
</script>
```

### 2. List Filtering

Optimize filtering of a large list:

```vue
<script setup>
const filter = ref('');

const filteredItems = computed(() => {
  return allItems.value.filter(item => 
    item.name.includes(filter.value)
  );
});

// Filtered items will check-in with debouncing
</script>
```

### 3. Dynamic Forms

Delay validation while the user is typing:

```vue
<script setup>
const formData = ref({});

watch(formData, (data) => {
  // Validation will be debounced
  fields.forEach(field => {
    desk.checkIn(field.id, { value: data[field.name] });
  });
}, { deep: true });
</script>
```

## Benefits of Debouncing

### Performance

- ✅ **Reduces calculations** - Fewer events = less processing
- ✅ **Optimizes rendering** - Avoids unnecessary re-renders
- ✅ **Saves resources** - Fewer network/API calls

### User Experience

- ✅ **Smooth response** - No lag during typing
- ✅ **Relevant results** - Waits for user to finish
- ✅ **Fewer requests** - Reduces server load

### Fine Control

- ✅ **MaxWait** - Guarantees eventual execution
- ✅ **Manual flush** - Force execution if needed
- ✅ **Cancel** - Cancel pending operations

## Best Practices

### 1. Choose the Right Delay

```typescript
// Search: 300-500ms (responsiveness vs performance)
checkInDelay: 400

// Validation: 500-1000ms (let the user finish)
checkInDelay: 800

// Scroll/Resize: 100-200ms (responsiveness is important)
checkInDelay: 150
```

### 2. Use maxWait

Always define a `maxWait` to avoid infinite waiting:

```typescript
createDebouncePlugin({
  checkInDelay: 500,
  maxWait: 2000, // Force after 2 seconds max
})
```

### 3. Proper Cleanup

Flush or cancel events before navigation:

```vue
<script setup>
onBeforeUnmount(() => {
  // Option 1: Execute pending events
  desk.flushDebounce?.();
  
  // Option 2: Cancel them
  // desk.cancelDebounce?.();
});
</script>
```

### 4. Combine with Other Plugins

Debounce works well with other plugins:

```typescript
const { desk } = createDesk('my-desk', {
  plugins: [
    createDebouncePlugin({ checkInDelay: 500 }),
    createLoggerPlugin({ verbose: true }),
    createValidationPlugin({ validate: ... }),
  ],
});
```

## Difference Between Debounce and Throttle

| Aspect | Debounce | Throttle |
|--------|----------|----------|
| **When** | After last event | At regular intervals |
| **Frequency** | Once after silence | N times per period |
| **Usage** | Search, validation | Scroll, resize |
| **Example** | Wait for user to finish | Limit scroll events |

:::tip[Tip]
Use **debounce** to wait for the end of a series of events (e.g., typing).
Use **throttle** to limit the frequency of continuous events (e.g., scroll).
:::

## Monitoring and Debugging

### Monitor Events

```vue
<script setup>
const eventLog = ref([]);

desk.onDebouncedCheckIn?.((id, data) => {
  eventLog.value.push({
    type: 'check-in',
    id,
    time: new Date().toLocaleTimeString(),
  });
});
</script>

<template>
  <div v-for="event in eventLog" :key="event.id">
    {{ event.time }}: {{ event.type }} - {{ event.id }}
  </div>
</template>
```

### Display Statistics

```vue
<template>
  <div class="stats">
    <div>Pending: {{ desk.pendingCheckInsCount }}</div>
    <div>Status: {{ desk.hasPendingDebounce ? 'Debouncing...' : 'Idle' }}</div>
  </div>
</template>
```

## Resources

- [Debounce Plugin API Documentation](/api/plugins/debounce)
- [Complete Code Example](https://github.com/benoitlahoz/vue-checkin/tree/main/app/components/examples/debounce-example)
- [Lodash Debounce](https://lodash.com/docs/#debounce) - Reference implementation

## Next Steps

- Explore the [Validation Plugin](/examples/form-example) to combine debounce and validation
- Discover the [History Plugin](/examples/plugin-example) to track history
- Learn to [create your own plugins](/guides/custom-plugins)
